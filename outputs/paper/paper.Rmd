---
title: "DeFi-ing Cyber Attacks"
subtitle: "A statistical analysis of cybersecurity attacks in decentralized finance"
author: 
  - Jack McKay
thanks: "Code and data are available at: https://github.com/jmacattack27"
date: "`r format(Sys.time(), '%d %B %Y')`"
abstract: "Decentralized finance (DeFi) describes the emerging ecosystem of financial services, protocols and applications built on and designed for public blockchains such as Ethereum and Algorand. One of the most promising applications of blockchain technology, DeFi has experienced explosive growth over the last few years. But with this growth has also come the attention of bad actors, who aim to exploit flaws in protocol security for personal gain. Using data collected by DEFIYIELD's REKT Database on the 200 most costly attacks on DeFi protocols, this paper will analyze and identify trends in these attacks, with the goal of identifying what types of attacks are most common and most costly to the DeFi sector as a whole, as well as for individual chains, in order to determine where cybersecurity efforts would best be focused."
output:
  bookdown::pdf_document2
toc: FALSE
bibliography: references.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include=FALSE}
library(tidyverse)
library(janitor)
library(tidyr)
library(dplyr)
library(ggplot2)
library(gridExtra)
library(tidyselect)
library(reshape2)
library("viridis")
library(kableExtra)
```


# Introduction

Imagine a world where financial services are available to anyone, from any location, 24 hours a day, 7 days a week, without the need for any intermediaries. One where financial transactions are fully automated, eliminating the need for any intermediary financial institutions, reducing human error and lowering transaction fees. All transactions are stored on a public, open-source ledger, allowing for complete transparency. Such a world is becoming increasingly feasible by the day, and the key to achieving it lies in decentralized finance (DeFi). DeFi is a completely open source and decentralized ecosystem running on blockchain technology that offers users financial services such as loans, payments, asset management and derivatives, as well as access to decentralized crypto exchanges (DEXes). DeFi minimizes--and in many cases eliminates-- the need for centralized institutions such as banks or brokerages. Interactions on DeFi are peer-to-peer and are completed via smart contracts, self-executing computer programs functioning as contracts between parties that automatically execute when certain pre-set conditions are met. As such, DeFi aims to return control over individual's finances back to the individual, restoring freedom of choice to the financial industry. The near-unlimited potential of DeFi has not gone unnoticed, with the industry as a whole experiencing incredible growth. DeFi's current market cap is \$147 billion as of April 2022, up from $2 Billion two years ago (@coinGecko), an annual growth rate of 757.32%. One of the primary drivers of this growth is a design principle known as "permissionless composability", wherein developers are able to employ any combination of pre-existing DeFi protocols, without requiring any permissions, in order to fulfill specific use cases. This allows developers to create and interact with limitless combinations of protocols, without any third party controlling any aspect of the network activity, creating a seamless and frictionless innovation cycle wherein users can build off of each others work. Indeed, permissionless composability is one of the fundamental innovations that has allowed DeFi to grow so quickly. However, this growth has not been without setbacks. One of the primary drawbacks to DeFi is its vulnerability to hackers. By nature of the way composability allows applications to work on top of each other, if the base chain was to suffer an attack, all of the applications built on top of it would also be at risk. As well, as transactions are executed automatically via smart contracts and without human oversight, this means that a bug in a smart contract can be exploited by hackers and used to reroute funds from the transaction. Due to these risks, identifying and preventing possible attacks is one of the primary focuses of the DeFi community at the moment. Using data collected by DEFIYIELD and scraped by Octoparse as well as secondary data from DefiLlama, this paper will analyze data on the 200 costliest attacks in decentralized finance in order to identify which types of attacks are most common, most costly, and most dangerous to particular chains. This is done with the overarching goal of determining where DeFi cybersecurity efforts would best be focused on both an industry level and individual level. 


# Data


## Data Source and Methodology

The primary data used in this report was collected by DEFIYIELD in their public Rekt Database, a database containing information on all recorded DeFi scams, hacks and exploits, including the total funds lost in each event, as well as a breakdown of the technical issues that led to the hack. Data on the 200 costliest attacks was then scraped from the DEFIYIELD's website via Octoparse, an a visual web data extraction software, before being downloaded into a .csv file, at which point it was uploaded to R, cleaned, and made ready for analysis. Further data on the total value locked (TVL) in each analyzed chain was obtained from DefiLlama's TVL database. This data consisted of 15 observations of two variables, Chain and TVL, and was manually acquired and included in the analysis. 


## Data Collection

The dataset used in this report contains information on the 200 costliest attacks in the DeFi space since the inception of cryptocurrency, with data on attacks as early as the Bitcoin Savings and Trust Ponzi scheme in July 2012, and as recently as the Elephant Money attack 2 weeks ago. The term 'attack' is used as a catch-all term to encompass any sort of malicious event occuring in the greater decentralized finance space in which funds were lost, with such events including hacks, rug pulls, exploits, dubious projects and exit scams. 

This dataset is a subset of the greater Rekt Database, which at the time of writing holds information on 2780 attacks. Data was collected and recorded manually by the team at DEFIYIELD over the course of multiple months, before the database was published in August 30, 2021, from which point it has been continuously updated. While DEFIYIELD is constantly recording new attacks and updating their database themselves, individuals can also report a claim if they have been affected by an attack themselves, at which point an engineer at DEFIYIELD will work to verify the report. If the claim is corroborated, the engineer will then analyze activity on whichever chain the attack is reported to have occurred, and if the claim is proven to be valid, the attack is then added to the database. Each entry in the database contains the following details:

  * The name of the exploited project & its associated URL
  
  * The chain on which the attack occurred
  
  * The date on which the attack occurred
  
  * The type of malicious event: (Exit Scam, Flash Loan, Exploit, Abandoned, Bank Run, Honeypot, Access Control)
  
  * The total funds lost in the attack

Malicious events are further defined as follows:

  * Exit Scam: When promoters of a cryptocurrency or DeFi protocol vanish during or soon after the initial coin offering (ICO) for
  their product. Promoters will market and promote the currency or concept in order to raise money from investors, before
  abandoning the project and disappearing with said money.
  
  * Flash Loan: A flash loan attack occurs when a bad actor manipulates the smart contract executing the flash loan in order to 
  siphon funds to their own wallet. For example, a flash loan attack might involve the malicious party changing the values of the 
  currencies being traded, in order to trick the smart contract into thinking the loan has been repaid when it hasn't.
  
  * Exploit: Any sort of hostile attack on a DeFi service that exploits a vulnerability or oversight in the protocol code. 
  Exploits can take many forms.
  
  * Abandoned: When a project is abandoned by its developers. Abandoned coins are referred to as 'dead coins'. 
  
  * Bank Run: Similar to with traditional banks, a bank run in DeFi refers to when holders of a token rapidly withdraw their
  assets, causing the token price to drop and leading to a negative feedback loop wherein other holders panic-sell their tokens,
  further lowering the price, causing even more users to sell their tokens, and so forth. The most recent example of a DeFi bank
  run occurred with Iron Finance's TITAN token, which dropped from US\$65 to US\$0.000000035 over the course of a single day.
  Stablecoins, particularly algorithmically backed stablecoins, are especially vulnerable to bank runs. 
  
  * Honeypot: An attack in which attackers create and send out smart contracts that have an apparent vulnerability, but contain a
  hidden trap, such that when an unsuspecting user goes to exploit the apparent vulnerability in the contract, the trap activates
  and allows the attacker to siphon the victims funds to themselves. 
  
  * Access Control: A scam in which the attacker obtains access to a targets digital wallet or authentication keys.
  
Further data on the total value locked (TVL) across each chain was manually obtained from DefiLlama's public TVL database and used to provide context to certain aspects of the analysis. The data in this database is acquired from CoinGecko, and consists of 107 observations of 7 variables;

  * Chain name
  * The number of active protocols on the chain
  * 1 day change in TVL
  * 7 day change in TVL
  * 1 month change in TVL
  * Total Value Locked
  * Market Cap / TVL
  
For our analysis we were are interested in the 15 chains included in our initial data set, and of those 15 chains we were only interested in the TVL, so the data pulled from this source consisted of 15 observations of 2 variables, chain name and TVL. 
  
  
## Data Analysis

This dataset scraped from DEFIYIELD's public Rekt Database via the data extraction software Octoparse (@Octoparse), before being imported to JupyterHub. Data was then processed and analyzed using the R programming language (@citeR), as well as tidyverse (@tidyverse), tidyr (@tidyr) and dplyr (@dplyr) programming packages. The package janitor (@janitor) was used to clean column names. gridExtra (@gridExtra) and reshape2 (@reshape2) were used to format the graphs, while viridis (@viridis) was used for data visualization, in particular modifying graph colours. 


## Strengths and Weaknesses

The data used in this study has both strengths and weaknesses. In particular, the database from which the data in this study was pulled is especially thorough in its technical breakdown of the attacks, including data on whether the attacked project's team is public, if the project had verified source code, as well as links containing proof of the attack and the wallets associated with the attack. The methods through which new data is added to the database are also thorough and involve multiple reviews of the incident, giving us confidence in the validity of the data. As well, the UI of the database website is user friendly, allowing parties to sort the data based on the chain on which the attack occurred, the type of attack, how much funds were lost and the date on which the attack occurred. The website also includes interactive graphs that help visualize the data. On the other hand, the website provides no option to download the database in its entirety or in any capacity, which leads to the main weaknesses of this data; the limited number of observations, and missed variables. As a result of being unable to download the database, I needed to use an external data extraction program, Octoparse, in order to download the data into a .csv file. While I was able to acquire a solid amount of observations on a number of useful variables, a lot of data was lost in the process. In particular, the number of attacks I could scrape was limited by the number of entries the REKT database could show on one page, which maxed out at 200. Luckily this was still enough data points to allow for meaningful statistical analysis, but it only accounts for 7.4% of the total data entries in the database. As well, due to the database's interface, Octoparse was unable to scrape certain variables, in particular the indicator variables: 'Public Team', 'Verified source code' and 'Audited code matches with deployed smart contracts code'. As well, due to the manner in which the technical breakdown of the attack was conveyed in the database, I was unable to use much of the detailed information in these breakdowns. Some of the variable values are rather broad, such as exploit, which encompasses a large variety of difference types of attacks; further dividing exploits into more defined categories would help with statistical analysis. Despite these weaknesses, the final data set retained much of the information on the attacks, and the most important variables were successfully captured. 


# Results

## Exploitation Rates by Chain

The first aspect of the data that I analyzed was which chains were being exploited most frequently. Summing the number of exploits on each chain into a new data frame, Figure \@ref(fig:chainproportion) shows the distribution of attacks across all recorded chains. Here we see that the vast majority of attacks occur on either Ethereum (ETH) or Binance Smart Chain (BSC); 50.5% and 30.5% respectively. The remaining 19% of attacks are spread more evenly across the other chains, with Polygon, Solana, Fantom and Avalanche (AVAX) accounting for a combined 12.5% of total attacks. The remaining 6.5% is distributed evenly across the remaining chains.


```{r, include = FALSE}
# Read in the raw data. 

raw_data <- read.csv (here::here("inputs/data/DeFiAttackData.csv"))

# Basic Data Cleaning

raw_data <- subset(raw_data, select = -c(Title:Date)) 
raw_data <- subset(raw_data, select = -c(Image1, Label, column))

raw_data <-
  raw_data %>% 
  rename(project_url = Name_URL,
         project = Name,
         chain = Info2,
         type_of_issue = Inf1,
         funds_lost = Price1,
         date = Date1)

cleaned_data <-
  raw_data %>% 
  slice_head(n = 200)

cleaned_data[1, 3] = 'RONIN'
cleaned_data$funds_lost = as.numeric(gsub("[\\$,]", "", cleaned_data$funds_lost))
```


```{r, include = FALSE}
# Graph the chains that are being most frequently exploited. 

# First creating a new data frame recording how many times each chain was exploited. 

chain_prop <- as.data.frame(table(cleaned_data$chain))[-c(1, 4, 7, 8), ]
chain_prop <- rename(chain_prop, Chain = Var1, Number.of.Exploits = Freq)

# Note that some of these exploits occurred on multiple chains. These entries are manually accounted for below

chain_prop[3, 2] = 57 + 4
chain_prop[5, 2] = 96 + 5
chain_prop[11, 2] = 7 + 3

chain_prop <- add_row(chain_prop, Chain = 'CRONOS', Number.of.Exploits = 1)

# Adding a column for the total number of recorded exploits on each chain

chain_prop$total_exploits <- c(1, 6, 1668, 2, 944, 16, 1, 3, 1, 1, 94, 1, 8, 1, 3)
```


```{r chainproportion, echo=FALSE, message=FALSE, warning=FALSE, fig.cap = "The Distribution of Attacks by Chain"}
# Now we can visualize the data

chain_prop %>% 
  ggplot(aes(x=Chain, y=Number.of.Exploits)) +
  geom_bar(stat='identity', fill='darkblue') +
  labs(x = 'Chain',
       y = 'Number of Exploits',
       title = "Number of Exploits per Chain") +
  scale_x_discrete(guide = guide_axis(n.dodge=3)) +
  theme(plot.title = element_text(hjust = 0.5))
```

Figure \@ref(fig:attackchainprop) shows the distribution of all recorded attacks on each chain, subcategorized into attacks that are among the 200 costliest and attacks that are not. Here we see that BSC and ETH are still by far the most attacked chains, but that BSC has been successfully attacked far more times than Ethereum, with BSC accounting for exactly 60% of all recorded attacks, while Ethereum accounts for 34%. This result, as well as a visual inspection of the graph, indicates that attacks on Ethereum are in general far more costly than attacks on BSC, and are also less frequent. The only other chain with a statistically significant amount of attacks is Polygon, with 94 recorded attacks, 10 of which are among the 200 costliest. Excluding attacks on BSC and ETH, Polygon accounts for 68.1% of all attacks, 5% of attacks in the top 200 costliest and 82.4% of all other attacks. 

```{r, include=FALSE}
# Creating a new dataframe in a format such that we can make a stacked barchart

new_prop2 <- data.frame(chain_prop$Number.of.Exploits, c('ALGO', 'AVAX', 'BSC', 'EOS', 'ETH', 'FANTOM', 'HARMONY', 'HECO', 'MOVR', 'POLKADOT', 'POLYGON', 'RONIN', 'SOLANA', 'TRON', 'CRONOS'))
new_prop2$ExploitCategory <- rep('Top 200 Costliest Attacks', 15)

reprows <- new_prop2[1:15,]
new_prop2 <- rbind(new_prop2, reprows)
new_prop2[16:30, 3] <- rep('All Other Attacks')
new_prop2[16:30, 1] <- c(0, 2, 1607, 0, 843, 11, 0, 1, 0, 0, 84, 0, 2, 0, 2)
colnames(new_prop2) <- c('Number of Attacks', 'Chain', 'Exploit Category')
```


```{r attackchainprop, fig.height = 7, fig.width = 11, echo=FALSE, message=FALSE, warning=FALSE, fig.cap = "Number of Attacks by Chain"}
# Visualizing the data
ggplot(new_prop2, aes(fill=`Exploit Category`, y=`Number of Attacks`, x=Chain)) + 
  geom_bar(position="stack", stat="identity") +
  labs(title = "Total Attack Distribution Across Chains, Categorized by Funds Lost") +
  scale_x_discrete(guide = guide_axis(n.dodge=3)) +
  theme(plot.title = element_text(hjust = 0.5))
```

Just looking at the number of attacks per chain doesn't give us the full picture on their security. There are numerous factors that would affect the number of attacks attempted on a given chain. One such factor is the varying total value locked (TVL) in each chain. The more value locked in a chain, the more liquidity exists to be exploited; as such, larger chains like Ethereum are naturally subject to more attacks. Using data from DeFi Llama (@Llama) on the total value locked across each chain, Figure \@ref(fig:adjustedattacks) shows the distribution of the number of exploits on each chain, divided by the TVL (in billions) in that chain. This gives us a more realistic picture of the rate at which each chain is being targeted. Note that this figure includes two graphs: one containing data on Polkadot, and one without data on Polkadot. Due to the relatively tiny amount of value locked in the Polkadot chain (about $3.84 million), the exploits to TVL ratio for Polkadot was more than 31x greater than the next highest ratio. As a result, the scale of the graph is disproportionately affected making it far less interpretable. As such, a second graph is included that omits data on Polkadot. Here we see a wildly different distribution than in the previous figure, with Ethereum going from the by far the most exploited chain to the third least exploited, while chains such as Algorand (ALGO), Heco, RONIN and EOS all saw substantial increases in their adjusted attack rates. Cronos and Tron remain the least exploited, while Avalanche (AVAX) also saw a noticeable decrease in exploit rates relative to the other chains. 


```{r adjustedattacks, fig.width=9, fig.height=9, echo=FALSE, message=FALSE, warning=FALSE, fig.cap = "The Distribution of Attacks Adjusted for Total Value Locked"}
# Adding a new column to our chain_prop data set containing the total value locked in each chain

chain_prop$TVL <- c(0.173, 10.57, 13.42, 0.255, 115.45, 5.21, 0.602, 0.343, 0.261, 0.004, 4.03, 0.218, 6.5, 4.2, 3.84)
chain_prop <- mutate(chain_prop, adjusted.exploits = Number.of.Exploits / TVL)

# We create a new data frame without data on Polkadot, to make the results more interpretable
chain_prop1 <- chain_prop[-c(10),]

# Our first graph, including data on Polkadot
x <- ggplot(data=chain_prop, aes(x=Chain, y=adjusted.exploits)) +
geom_bar(stat='identity', fill='darkblue') +
labs(x = 'Chain',
     y = 'Ratio of Exploits to TVL',
     title = "Successful Attacks Adjusted for TVL (Including Polkadot)") +
scale_x_discrete(guide = guide_axis(n.dodge=3)) +
  theme(plot.title = element_text(hjust = 0.5))

# Our scond graph, excluding data on Polkadot
y <- ggplot(data=chain_prop1, aes(x=Chain, y=adjusted.exploits)) +
geom_bar(stat='identity', fill='darkblue') +
labs(x = 'Chain',
     y = 'Ratio of Exploits to TVL',
     title = "Successful Attacks Adjusted for TVL (Excluding Polkadot)") +
scale_x_discrete(guide = guide_axis(n.dodge=3)) +
  theme(plot.title = element_text(hjust = 0.5))

grid.arrange(x, y, nrow = 2)
```


## Attack Rates by Type of Attack

The next aspect of the data I analyzed was the distribution of attack data, in terms of what types of attacks are most common, which types have historically resulted in the most damage, and which types are most damaging on average. Figure \@ref(fig:attackdata) shows the distribution of attack types, based on frequency, total damage and average damage. Here we see that exploits are by far the most prevalent types of attacks across all metrics, accounting for 45.5% of attacks,  making exploits more than twice as common as any other attack, and almost 3 times more costly on average. We also notice that despite being the second most common attack at 21%, exit scams are only the 4th costliest attacks on average, with both access control and flash loan attacks costing more on average. Abandoned projects are by far the least common attack, and are only slightly less costly than honeypot attacks, the second least damaging attack.


```{r, include=FALSE}
# Creating a new data set containing the number of attacks of each type and the net funds lost via each attack

attack_prop <- as.data.frame(table(cleaned_data$type_of_issue))

# Summing the total funds lost via each type of attack
exploit_funds <- sum(cleaned_data[cleaned_data$type_of_issue=="Exploit",]$funds_lost)
abandoned_funds <- sum(cleaned_data[cleaned_data$type_of_issue=="Abandoned",]$funds_lost)
exit_scam_funds <- sum(cleaned_data[cleaned_data$type_of_issue=="Exit Scam",]$funds_lost)
flash_loan_funds <- sum(cleaned_data[cleaned_data$type_of_issue=="Flash loan",]$funds_lost)
access_control_funds <- sum(cleaned_data[cleaned_data$type_of_issue=="Access control",]$funds_lost)
honeypot_funds <- sum(cleaned_data[cleaned_data$type_of_issue=="Honeypot",]$funds_lost)

attack_prop$total_funds_lost <- c(abandoned_funds, access_control_funds, exit_scam_funds, exploit_funds, flash_loan_funds, honeypot_funds)
attack_prop <- mutate(attack_prop, avg_funds_lost = total_funds_lost / Freq)
```


```{r attackdata, fig.width=9, fig.height=9, echo=FALSE, message=FALSE, warning=FALSE, fig.cap = "Distribution of Attack Type by Quantity, Net Loss and Average Loss per Attack"}
atk_freq <- ggplot(data=attack_prop, aes(x=Var1, y=Freq)) +
  geom_bar(stat='identity', fill='darkgreen') +
  labs(x = 'Type of Attack',
       y = 'Number of Attacks',
       title = "Number of Attacks") +
  theme(plot.title = element_text(hjust = 0.5))

atk_net_dmg <- ggplot(data=attack_prop, aes(x=Var1, y=total_funds_lost)) +
  geom_bar(stat='identity', fill='darkred') +
  labs(x = 'Type of Attack',
       y = 'Total Funds Lost',
       title = "Total Funds Lost by Attack") +
  theme(plot.title = element_text(hjust = 0.5))

atk_avg_dmg <- ggplot(data=attack_prop, aes(x=Var1, y=avg_funds_lost)) +
  geom_bar(stat='identity', fill='purple') +
  labs(x = 'Type of Attack',
       y = 'Avg Funds Lost per Attack',
       title = "Average Funds Lost per Attack") +
  theme(plot.title = element_text(hjust = 0.5))

grid.arrange(atk_freq, atk_net_dmg, atk_avg_dmg, ncol = 1)
```

Furthering my analysis into attack rates, we next look at the total number of attacks recorded in the REKT database. Figure \@ref(fig:allattacks) shows the distribution of all attacks registered in the REKT database. Here we see a wildly different distribution than previously, with honeypots accounting for 66.6% of all recorded DeFi attacks compared to 2.5% of the 200 costliest attacks. Exit scams remain the second most frequent attack at 21.8% while exploits now account for only 6.3% of all attacks compared to 45.5% previously, marking a 622% drop in frequency. Figure \@ref(fig:atkdmgchance) puts all of this data into a table, including a column "Likelihood", which describes the likelihood that an attack of a particular type is one of the 200 costliest attacks. Here we see that flash loans are by far the most likely to be among the 200 costliest attacks, with 36 of the 42 total recorded flash loan attacks being among the 200 costliest, or about 85.7%. Exploits are the second most likely with about 50.5% of all exploits being among the 200 costliest. In stark contrast, we note that honeypots have by far the lowest chance at 0.3%, about 22.3 times less likely than the second least likely attack, exit scams. 


```{r allattacks, echo=FALSE, message=FALSE, warning=FALSE, fig.cap = "Distribution of All Recorded Attacks"}

# Adding a column recording the total number of recorded attacks of each type
attack_prop$all_attacks<- c(14, 97, 623, 180, 42, 1907)

# Graphing this distribution
net_atk_freq <- ggplot(data=attack_prop, aes(x=Var1, y=all_attacks)) +
  geom_bar(stat='identity', fill='maroon2') +
  labs(x = 'Type of Attack',
       y = 'Number of Recorded Attacks',
       title = "Total Number of Recorded Attacks of Each Type") +
  theme(plot.title = element_text(hjust = 0.5))

net_atk_freq
```


```{r atkdmgchance, fig.width=12, fig.height=12, echo=FALSE, message=FALSE, warning=FALSE, fig.cap = "Distribution of All Recorded Attacks"}

# Adding a column recording the likelihood that a given attack will be one of the 200 costliest
attack_prop <- mutate(attack_prop, likelihood = 100 * round(Freq / all_attacks, digits=3))
attack_prop$likelihood <- paste0(attack_prop$likelihood, '%')


attack_prop %>% 
  select(Var1, Freq, total_funds_lost, avg_funds_lost, all_attacks, likelihood) %>% 
  kable(
    caption = "Key Data on Attacks",
    col.names = c("Type of Attack", "Attacks (Top 200)", "Net Funds Lost\n(Top 200)", "Average Funds Lost (Top 200)", "Total Recorded Attacks", "Likelihood"),
    digits = 2,
    booktabs = TRUE,
    linesep = ""
  ) %>% 
column_spec(3:5, width = "3cm")

```


The next aspect of the data I analyzed is how the frequency of each type of attack is changing over time. Figure \@ref(fig:attackevo) shows the number of each type of attack year over year since 2016. Here we see that the every type of attack increased in frequency in 2021, with exploits experiencing by far the greatest spike. As well, we see proportionally more attacks per month in 2022 than we did in 2021, indicating that attacks are becoming both more common and costlier.  


```{r, include=FALSE}
# Data wrangling in order to get a dataset containing the number of attacks of each time per year since 2016
attack_time <- cleaned_data[, c("type_of_issue", "date")]

attacks2022 <- attack_time[grep("2022$", attack_time$date), ]
attacks2021 <- attack_time[grep("2021$", attack_time$date), ]
attacks2020 <- attack_time[grep("2020$", attack_time$date), ]
attacks2019 <- attack_time[grep("2019$", attack_time$date), ]
attacks2018 <- attack_time[grep("2018$", attack_time$date), ]
attacks2017 <- attack_time[grep("2017$", attack_time$date), ]
attacks2016 <- attack_time[grep("2016$", attack_time$date), ]
attacks2015 <- attack_time[grep("2015$", attack_time$date), ]
attacks2014 <- attack_time[grep("2014$", attack_time$date), ]
attacks2013 <- attack_time[grep("2013$", attack_time$date), ]


attacktype2022 <- as.data.frame(table(attacks2022$type_of_issue))
attacktype2021 <- as.data.frame(table(attacks2021$type_of_issue))
attacktype2020 <- as.data.frame(table(attacks2020$type_of_issue))
attacktype2019 <- as.data.frame(table(attacks2019$type_of_issue))
attacktype2018 <- as.data.frame(table(attacks2018$type_of_issue))
attacktype2017 <- as.data.frame(table(attacks2017$type_of_issue))
attacktype2016 <- as.data.frame(table(attacks2016$type_of_issue))
attacktype2015 <- as.data.frame(table(attacks2015$type_of_issue))
attacktype2014 <- as.data.frame(table(attacks2014$type_of_issue))
attacktype2013 <- as.data.frame(table(attacks2013$type_of_issue))


attackyr <- attacktype2020
attackyr <- add_row(attackyr, Var1 = "Abandoned", Freq = 0, .before = 0)
attackyr <- add_row(attackyr, Var1 = "Honeypot", Freq = 0)
attackyr$`2021` <- attacktype2021$Freq
attackyr$`2022` <- c(0, 6, 11, 18, 4, 0)
attackyr <- rename(attackyr, type_of_attack = Var1,
                    `2020` = Freq)
attackyr$`2016` <- c(0, 0, 0, 1, 0, 0)
attackyr$`2017` <- c(0, 0, 0, 0, 0, 0)
attackyr$`2018` <- c(0, 0, 0, 1, 0, 0)
attackyr$`2019` <- c(0, 1, 0, 0, 0, 0)
attackyr <- attackyr[, c(1, 5, 6, 7, 8, 2, 3, 4)]


thing <- attackyr[, -c(1)]
thing2 <- as.data.frame(t(thing))
thing2 <- rename(thing2,
                 Abandoned = V1,
                 `Access control` = V2,
                 `Exit Scam` = V3,
                 Exploit = V4,
                 `Flash loan` = V5,
                 Honeypot = V6)
thing2$Date <- c(2016, 2017, 2018, 2019, 2020, 2021, 2022)
df <- melt(thing2 ,  id.vars = 'Date', variable.name = 'Type of Attack')
```


```{r attackevo, fig.width=9, fig.height=5, echo=FALSE, message=FALSE, warning=FALSE, fig.cap = "Number of Attacks per Year"}

ggplot(df, aes(Date, value)) +
  geom_line(aes(colour = `Type of Attack`)) +
  labs(x = 'Year',
      y = 'Number of Attacks',
      title = 'Types of Attacks by Year') +
  geom_point(aes(colour = `Type of Attack`)) +
  theme(plot.title = element_text(hjust = 0.5))

```

\newpage

## Attack Data by Chain

The final aspect of the data I will analyze is the attack data for individual chains. Of the chains in our data set, only Ethereum, BSC and Polygon have witnessed enough attacks for the data to be statistically significant and interesting. Figure \@ref(fig:attackpropbychain) shows the number of attacks on these chains, broken down by type of attack, so that we may see if certain chains are particularly vulnerable to certain types of attacks. Here we see that exit scams account for a noticeably smaller proportion of attacks on Ethereum compared to other chains, with BSC experiencing 38% more exit scam attacks in total than Ethereum, despite experiencing 39.6% less attacks in total. Exit scams accounted for 50%, 42.9% and 29.5% of the attacks on Solana, Polygon and BSC respectively, compared to only 13% of attacks on Ethereum, indicating that Ethereum is particularly secure against exit scams. On the other hand, we see that Ethereum is disproportionately affected by access control attacks, which account for 16.2% of attacks on ETH, compared to only 6.9% of attacks on BSC, and 0% of the attacks on Solana or Polygon. As well, ETH is the only chain to have experienced a honeypot exploit, which account for 5.1% of ETH attacks. Interestingly, flash loans account for a very similar proportion of attacks on ETH, BSC and Polygon, at 19.2%, 21.3% and 28.6% respectively, while not Solana did not experience any such attacks. 


```{r, include=FALSE}
eth_data <- cleaned_data[grep("ETH", cleaned_data$chain), ]
bsc_data <- cleaned_data[grep("BSC", cleaned_data$chain), ]
poly_data <- cleaned_data[grep("POLYGON", cleaned_data$chain), ]
sol_data <- cleaned_data[grep("SOLANA", cleaned_data$chain), ]


eth_prop <- as.data.frame(table(eth_data$type_of_issue))
bsc_prop <- as.data.frame(table(bsc_data$type_of_issue))
poly_prop <- as.data.frame(table(poly_data$type_of_issue))
sol_prop <- as.data.frame(table(sol_data$type_of_issue))

bsc_prop <- add_row(bsc_prop, Var1 = "Abandoned", Freq = 0, .before = 0)
bsc_prop <- add_row(bsc_prop, Var1 = "Honeypot", Freq = 0)

poly_prop <- add_row(poly_prop, Var1 = "Access control", Freq = 0, .before = 0)
poly_prop <- add_row(poly_prop, Var1 = "Abandoned", Freq = 0, .before = 0)
poly_prop <- add_row(poly_prop, Var1 = "Honeypot", Freq = 0)

sol_prop <- add_row(sol_prop, Var1 = "Access control", Freq = 0, .before = 0)
sol_prop <- add_row(sol_prop, Var1 = "Abandoned", Freq = 0, .before = 0)
sol_prop <- add_row(sol_prop, Var1 = "Flash loan", Freq = 0)
sol_prop <- add_row(sol_prop, Var1 = "Honeypot", Freq = 0)

chainattack <- data.frame(eth_prop$Freq, bsc_prop$Freq, poly_prop$Freq, sol_prop$Freq)
colnames(chainattack) <- c("ETH", "BSC", "Polygon", "Solana")
rownames(chainattack) <- c("Abandoned", "Access control", "Exit Scam", "Exploit", "Flash loan", "Honeypot")
```


```{r attackpropbychain, fig.width=9, fig.height=5, echo=FALSE, message=FALSE, warning=FALSE, fig.cap = "Number of Attacks per Chain by Attack Type"}
barplot(as.matrix(chainattack), 
        col=viridis(6), 
        border="white", 
        space=0.04, 
        font.axis=2, 
        xlab="Chain",
        ylab="Type of Attack",
        main="Proportion of Attacks Across Chains",
        legend=TRUE)
```



# Discussion

## Attack Prevalence and the Danger of Exploits

By far the most prominent type of attacks in our data are exploits, which showed to be the most frequent, cause the most damage in total, and cause the most damage on average. Of the 10 costliest attacks, exploits accounted for 5, including each of the 3 costliest attacks. There are multiple reasons why this is the case. First, exploit is a very broad term that encompasses any attack resulting from a software vulnerability or security flaw. This means that specific exploits such as Sybil attacks and 51% attacks are both categorized as exploits in this data set. As well, there are a multiplicity of avenues that one could use to exploit a protocol, such as the exchange a token is traded on, the smart contracts dictating trades, exploiting an oversight in the chain that the protocol runs in, or an oversight in the protocol code itself. As such, it is expected that exploits would be the most common types of attack, as it is an umbrella term. This does not, however, explain why exploits result in substantially more funds being lost on average than any other attack. An exploit will on average result in more than twice as many lost funds as the second costliest type of attack, access control. In fact, if we sum the average cost of every other type of attack, the resulting sum is still only 7.7% more costly than the average exploit. These results changed when looking at the total number of attacks as opposed to just the top 200 costliest, where we saw exploits fall from by far the most frequent attack (45.5%) to the 3rd most frequent attack (6.3%). This supports the earlier finding that exploits are by far the costliest attack on average, and indicates that while exploits are harder to find than originally thought, the reward for finding them (or cost for having them) is huge. 


## Flash Loans

Of the analyzed attack data, one of the most notable results was the rate at which flash loan attacks end up among the 200 costliest attacks; despite accounting for only 1.5% of all recorded attacks, 85.7% of all flash loan attacks were among the 200 costliest attacks, by far the greatest likelihood of any attack. Flash loan attacks occur involve taking out a flash loan from a lending protocol, arbitraging the borrowed money, and then manipulating the price of the one or multiple tokens in order to turn a profit, before returning repaying the loan. Flash loan attacks are particularly costly for a number of reasons. All flash loans are executed via smart contract, meaning that flash loans are entirely automated. By nature of the instantaneous execution of flash loans, attackers are able to both repeat the process multiple times, as well as execute it across multiple markets. Not only this, but because the market manipulation is performed with loaned assets drawn from a general lending pool, returning these assets to the pool effectively washes the attacker's hands of the attack and eliminates much of the trace, making flash loan attacks especially low risk for attackers. Somewhat ironically, the key factors that make flash loans so innovative--anonymity, no collateral and instantaneous execution--are the same things that make them so costly when exploited. 


## Overall Chain Security

In our initial graph of the distribution of attacks across chains, we saw that the vast majority of attacks occured on BSC or ETH. However, this graph is misleading with regards to its implications for chain security; because we are looking at the distribution of the 200 costliest attacks, chains with a larger userbase such as ETH and BSC are naturally more likely to record more such attacks. Thus, we also graph the distribution of all attacks in Figure \@ref(fig:attackchainprop), with each attack being categorized as either in the top 200 or not. Here we see that BSC has experienced by far the most successful attacks, followed by Ethereum, with a substantial drop off between Ethereum and the next most attacked chain, Polygon. When we adjust for 
the size of the chain by taking the ratio of attacks to total value locked in Figure \@ref(fig:adjustedattacks), we see that EOS is now the most exploited chain, with a Attack to TVL ratio of 7.83, compared to 0.874 for ETH and 4.54 for BSC. Notably, ETH saw the sharpest drop relative to the other chains when accounting for TVL, dropping from by far the most attacked chain to the 11th most. This indicates that relative to its size, Ethereum is actually one of the most secure chains that we analyzed. Furthermore, in reality Ethereum is even more secure than this metric indicates. If, for example, instead of considering total value locked in a chain in terms of dollars we consider the total value locked in a chain as a percentage of the total value locked across all chains, then we would see that while TVL in Ethereum currently accounts for 54.81% of TVL across all chains, it accounted for 72.95% as recently as last year (@Llama). If we go back a couple months further to January 2021, Ethereum accounted for a whopping 97.18% of all the value on chains, completely dominating the space. In Figure \@ref(fig:attackevo), we see that a significant portion of the 200 costliest attacks occurred in and before 2021. This means that while Ethereum has experienced the most costly attacks and the second most attacks overall, it has been by far the biggest target of any chain since our earliest data points, and while relative to its current TVL it appears to be the 4th most secure chain, in reality it is likely far more secure than this metric indicates.  


## Chain Security to Specific Attacks

In Figure \@ref(fig:attackpropbychain) we see the distribution of attacks on Ethereum, BSC, Polygon and Solana, categorized by type of attack. Here we note that Ethereum appears particularly secure against exit scams, which account for only 12.87% of attacks on Ethereum, compared to 29.51% of attacks on BSC, 42.8% of the attacks on Polygon and 50% of the attacks on Solana, however the latter 2 statistics are less meaningful due to the far smaller sample size. An exit scam involves heavily promoting a project in order to drive investment from individuals or companies, before running away with investor's money. By their nature, exit scams are more about manipulating individuals than they are exploiting loopholes or technical oversights. As such, the best defense against exit scams doesn't involve cybersecurity so much as it does educating your userbase about exit scams and how to spot them. A brief scroll through Ethereum's [website](https://ethereum.org/en/) reveals the strides that Ethereum has made in the realm of user education, with a dedicated "Learn" section containing guides on everything to do with Ethereum, from smart contracts to consensus mechanisms, including a section titled "Ethereum security and scam prevention" which outlines basic safety practices as well as common scams and how to spot them. At the bottom this section is a list of links for further reading, including multiple links on web security, crypto security and indeed scam education. Of all the chains, Ethereum has by far the greatest wealth of information resources on everything to do with crypto, as well as specific sections dedicated to scam detection and prevention. Needless to say, this would almost invariably play a factor in the distinctly low rate of exit scams on Ethereum.

Another notable result is the disproportionate rate at which Ethereum appears affected by access control scams, which involve a hacker gaining access to one or multiple user's wallets and siphoning user funds to their own account. At first glance this seems to contradict the previous result about Ethereum's successful efforts in educating its users; after all, gaining access to a users wallet involves getting the users key, which usually occurs as a result of the user inadvertently exposing his own key. Thus,  access control scams would appear to be another type of scam wherein the individual user is most often at fault, rather than a coding oversight. However, reading through the technical breakdown of some of the costliest access control scams on the REKT database shows that this is not always the case. For example, the costliest recorded access control scam occurred back in December 2021, when gaming and NFT platform Vulcan Forged was hacked, exposing 96 high value wallets. Vulcan Forged offers users a wallet service known as MyForge, which allows users to manage their wallets through Vulcan's platform. The passwords to users wallets were co-managed by both the user and Vulcan, with Vulcan storing user's private keys on their own side. Thus, when Vulcan was hacked, hackers gained access to 96 user's wallets, stealing 4.5 million PYR tokens (Vulcan's native token), or about 23% of the circulating supply (@cryptobriefing), roughly equivalent to $140 million. Because Vulcan Forged is built on Ethereum, and the lost of funds occurred due to hackers gaining access to user's private keys, this attack is classified as an access control attack on Ethereum, despite no wrongdoing or bad security practices on behalf of the users. Many of the other Ethereum access control hacks also occur in a similar method, where a protocol built on Ethereum is hacked and user's private keys are exposed. This is indicative of one possible reason for the prevalence of access control hacks on Ethereum; there are far more projects built on Ethereum than on any other chain, and of the projects built on other chains, many of them are also launched on Ethereum as well. DeFi Prime, a digital media and analytics service build for the DeFi community, has a total of 225 DeFi projects listed in their DeFi ecosystem, of which 203 are built on Ethereum, compared to 43 built on BSC (@prime). Simply put, this means that there are there more avenues for hackers to gain access to user passwords on Ethereum than on other chains.


## Weaknesses

There were a number of difficulties encountered while writing this report, specifically relating to data collection and formatting. In particular, the inability to download the REKT database made acquiring the data particularly tedious, and required the use of an external web data extraction software in Octoparse. While I successfully downloaded data from the database, due to limitations with the extraction software, I could only download as many data entries as could be displayed on a single page, 200 in this case. While this was enough data for a statistically meaningful analysis, it would have been incredibly insightful to have the roughly 2500 excluded data points. Despite this limitation, I was able to manually input a fair amount of data which was useful in providing additional context to the original data set. However, this in and of itself could be seen as a weakness, as this additional data is then subject to human error. As well, the format in which the data was downloaded made data visualization particularly cumbersome, with me often having to create entirely new data frames for each graph or set of graphs, making the data exploration especially complicated. 

Another weakness of my analysis pertains to the data itself, and the lack of specificity seen in some of the variables, specifically when talking about the types of attacks seen. While there is a solid breakdown of the various types of attacks, it would have been insightful if some of the values--specifically exploit--were further broken down based on what aspect of the chain or project was exploited. As it stands, exploit acted as sort of an umbrella term for a number of possible issues, which made it harder to perform a more technical analysis of the attacks and led to some overcentralization in the attack data of our initial data set. The manual addition of data on all recorded attacks helped mitigate some of this overcentralization by providing further context to the data.

The final weakness of my report is that I did not answer all of my intended research questions, specifically what may precipitate an attack. Due to the lack of detailed technical data on each attack, there was simply not enough information for me to properly investigate this question. Still, the majority of my research questions were answered. 


# Conclusions and Going Forward

There are a number of conclusions that can be drawn from this data. In particular, we see that honeypots are by far the most frequent type of attack across all analyzed chains, but comparatively result in far less damages than all other attacks, besides abandoned projects. The prevalence of honeypots indicates that more effort should be put into mitigating them. However, honeypots also present a unique opportunity, with the ability to research and analyze the behaviour of would-be attackers. Honeypots deployed for this reason are referred to as 'research honeypots', and can be used to proactively develop preventative defenses against hostile attacks. For this reason, as well as the low average cost of a honeypot attack, they are not a top priority in terms of attacks to defend against. Rather, that honor goes to exploits, which account for the vast majority of the top 200 costliest attacks, and are by far the most damaging attacks on average. However, because exploits can occur as a result of an oversight in the code associated with a project, chain or smart contract, they are also the hardest type of attack to combat. As well, because exploits are essentially the result of a coding error, the main defense against them would simply be to invest more money into software engineers and computer scientists to audit and inspect a projects code in order to proactively find errors before attackers do. For a given project, this could take the form of a designated team whos sole objective is to try and find exploits in the projects associated code. With regards to specific chains, we conclude that of chains with a meaningful amount of data, Ethereum reigns supreme in terms of security, while BSC appears to be less secure compared to other chains. In particular, Ethereum is especially secure against exit scams, and this is likely due in part to their extensive efforts in educating their userbase, which has invariably helped prevent other types of attacks as well. In this regard, BSC, Polygon and Solana all should invest further in user education. As the decentralized finance ecosystem continues to rapidly evolve and grow, so too will the attempts to exploit this sector for personal gain, and it is through consistent and concerted investment into cybersecurity and user education that we can work towards bulletproofing this blossoming technology so that it may reach its full potential.  


\newpage

\appendix

# Appendix 

## Key Terms

Below is a alphabetized list containing key terms used throughout this paper and their definitions. 

  * Abandoned: When a project is abandoned by its developers. Abandoned coins are referred to as 'dead coins'. 

  * Access Control: A scam in which the attacker obtains access to a targets digital wallet or authentication keys.

  * Bad Actor: An entity that aims to circumvent security protocols and exploit projects and/or individuals for personal gain.
  
  * Bank Run: Similar to with traditional banks, a bank run in DeFi refers to when holders of a token rapidly withdraw their
  assets, causing the token price to drop and leading to a negative feedback loop wherein other holders panic-sell their tokens,
  further lowering the price, causing even more users to sell their tokens, and so forth. The most recent example of a DeFi bank
  run occurred with Iron Finance's TITAN token, which dropped from US\$65 to US\$0.000000035 over the course of a single day.
  Stablecoins, particularly algorithmically backed stablecoins, are especially vulnerable to bank runs.
  
  * DeFi: Refers to decentralized finance, an ecosystem of financial services, products and applications that can be accessed
  anonymously, are decentralized and are built on and for public blockchains, such as Ethereum. 
  
  * Blockchain / Chain: A decentralized database that stores encrypted blocks of data and chains them together to form a chronological
  ledger for the data. Blockchains are the fundamental innovation upon which the decentralized finance industry is built.
  
  * Exit Scam: When promoters of a cryptocurrency or DeFi protocol vanish during or soon after the initial coin offering (ICO) for
  their product. Promoters will market and promote the currency or concept in order to raise money from investors, before
  abandoning the project and disappearing with said money.
  
  * Exploit: Any sort of hostile attack on a DeFi service that exploits a vulnerability or oversight in the protocol code. 
  Exploits can take many forms.
  
  * Flash Loan: A form of uncollateralized lending executed via smart contract that allows users to borrow any
  available amount of assets without posting any collateral. Instead, the liquidity from a flash loan must be instantly repaid
  to the lender within a single block transaction. If the borrower doesn't repay the capital, the transaction is instantly 
  reversed. 
  
  * Honeypot: An attack in which attackers create and send out smart contracts that have an apparent vulnerability, but contain a
  hidden trap, such that when an unsuspecting user goes to exploit the apparent vulnerability in the contract, the trap activates
  and allows the attacker to siphon the victims funds to themselves. 
  
  * Smart Contract: A self-executing agreement, written in lines of code, that automatically executes when predetermined
  conditions are met. Smart contracts allow for agreements to execute instantaneously, without the involvement of intermediaries,
  and such that all participants can be certain of the outcome. Smart contracts are one of the fundamental building blocks of 
  decentralized finance. 
  
  * Stablecoin: A digit asset engineered to maintain a stable value relative to some national currency or other value-based asset.
  A stablecoin that is designed to replicate the value of another asset is considered "pegged" to that asset. Maintaining 
  its peg to its associated asset is one of the primary focuses of stablecoins, which can be further classified based on the 
  method used to maintain their peg:
  
    - Collateralized Stablecoins: Achieve price stability through holding reserves of fiat currencies equal to or greater than the
    market cap of the coin. Currently the most popular type of stablecoin, with examples including Tether (USDT) and USD Coin   
    (USDC).
  
    - Algorithmic Stablecoins: A stablecoin model involving 2 tokens: a stablecoin and a token that shares in the system's profits
    from new issuance of stablecoins. Shares in the latter token are issued to holders of the former, and allow for developers to 
    maintain the stablecoin's price by controlling the supply, without harming holders.

  

# Additional details


\newpage


# References

